<nav id="sidebar">
  <%= image_tag "ladybird_keypress.png", alt: "finger pressing a key", size: "72x72"%>
  <ul>
    <%= 
      raw(generate_tree_from_article_list(Article.order(:title).all, article))
    %>
    <li class="border"></li>
    <%= image_tag "ladybird_computer_02.png", alt: "mini-computer", size: "72x72"%>
    <li><%= link_to "Guestbook", guestbook_index_path, class: "controls" %></li>
    <% if request.path == guestbook_index_path %>
      <li><%= link_to "New Entry", new_guestbook_path, class: "controls" %></li>
    <% end %>
    <% if current_user %>
      <% if article && article.id %>
        <li> <%= link_to "Edit", edit_article_path(article), class: "controls" %> </li>
        <li><%= link_to "Destroy", article_path(article), class: "controls", data: {
                          turbo_method: :delete,
                          turbo_confirm: "Are you sure you want to delete this article (#{article.title})?"
                        } %></li>
      <% end %>
      <li><%= link_to "New Article", new_article_path, class: "controls" %></li>
      <li><%= link_to "Uploads", uploads_path, class: "controls" %></li>
      <% if request.path == uploads_path %>
        <li><%= link_to "New Upload", new_upload_path, class: "controls" %></li>
      <% end %>
      <li><%= link_to 'Log Out', logout_path, class: "controls", data: {
                          turbo_method: :get,
                          turbo_confirm: "Are you sure you want to log out, #{current_user.name}?"
                        } %></li>
    <% else %>
      <li><%= link_to 'Login', login_path, class: "controls" %></li>
    <% end %>
    <script defer>
      {
        let current_article = document.getElementById("current-article-link")
        if (current_article) {
          let parentNode = current_article.parentNode
          while (parentNode) {
            parentNode.open = "true"
            parentNode = parentNode.parentNode
          }
        }
      }
    </script>
  </ul>
  <%= image_tag "ladybird_smiling_computer.png", alt: "smiling computer", size: "72x72" %>
</nav>
